Slide 1:
Memory Management and Virtual Memory

Slide 2:
Memory Management
تعتبر ذاكرة الوصول العشوائي (RAM) أحد أكثر أجزاء الحاسب تأثيرًا على أداءه، إذ أن التقنيات التي يستعملها الجهاز للتعامل مع الذاكرة يمكنها أن تؤثر في أداء الجهاز بشكل كبير، لذلك كان هدف كثير من البحوث هو الوصول إلى تقنيات وخوارزميات تمكننا من استعمال الذاكرة بأفضل شكل ممكن لضمان فعاليتها.
2

Slide 3:
Memory Management (Contd.)
نعرف أن الذاكرة تستعمل لتخزين الأوامر والبيانات التي تخص البرامج التي يعمل عليها المعالج في الوقت الحاضر (processes) وحيث أن هدف :-
هو أن يعمل المعالج على أكبر عدد ممكن من البرامج دون ، حصول انحدار كبير في مستوى الأداء، فإن هدفنا أيضًا هو أن نفعل استخدام الذاكرة بحيث تستوعب أكبر عدد ممكن من البرامج.
3

Slide 4:
Memory Management (Contd.)
4
عند فحص سلوك المعالج يلاحظ في كثير من الحالات أن المعالج لا يشترط أن يكون كامل البرنامج موجود في الذاكرة العشوائية ليتمكن من معالجته، مثل:
البرامج التي تحتوي على أقسامٍ الغرض منها معالجة حالات خاصة نادرة الحدوث فقط، وإن كان المعالج سيحتاج جميع أقسام البرنامج لمعالجته، فإنه غالبًا لايحتاج هذه الأقسام في نفس الوقت، بل في أوقات مختلفة خلال عملية المعالجة، وحتى نتجنب حجز مكان ثمين في الذاكرة لأجزاء قد لا تستحقها، تم الاستعانة بتقنية الذاكرة الافتراضية، التي تمّكن النظام من تنفيذ برامج لا تقع بالكامل في الذاكرة العشوائية بل الأجزاء الضرورية منها.

Slide 5:
Memory Management (Contd.)
مبدأ تشغيل البرامج بدون تحميلها كاملًة إلى الذاكرة العشوائية لديه الكثير من الفوائد سواء على مستوى النظام أم على مستوى المستخدم
يمكن للمبرمجين برمجة العديد من البرامج الطويلة دون الأخذ بعين الاعتبار محدودية الذاكرة العشوائية للأجهزة المستهدفة، بالتالي تسهيل عملية صنع البرامج.
المستخدمون لأنظمة تطبق مبادئ الذاكرة الافتراضية يمكنهم العمل على عدة برامج في نفس الوقت، وإن كانت الذاكرة العشوائية لا تتحمل حجم جميع هذه البرامج مجتمعة.
5

Slide 6:
Virtual Memory
إن تقنية الذاكرة الافتراضية (Virtual Memory) تطبق مبدأ الفصل بين مفهومين للمساحة التي تمّثل البرنامج (الأوامر والبيانات):
(virtual address space) مساحة البرنامج الافتراضية التي يراها المبرمج أو المستخدم .
(actual address space) ومساحته الفعلية التي يطبقها الجهاز عند تحميل وتشغيل البرنامج .
The concept of a logical address space that is bound to a separate physical address space is central to proper memory management
Logical address – generated by the CPU; also referred to as virtual address
Physical address – address seen by the memory unit
Logical and physical addresses are the same in compile-time and load-time address-binding schemes; logical (virtual) and physical addresses differ in execution-time address-binding scheme
6

Slide 7:
Base and Limit Registers
7

Slide 8:
Dynamic relocation using a relocation register
8

Slide 9:
Virtual Memory
فالمساحة الافتراضية تفترض أن البرنامج مخزن في الذاكرة ابتداءً من عنوان افتراضي (logical address) ، ثم تمتد مساحة البرنامج بشكل مستمر ومتصل، لكن مبدأ تقسيم البرامج إلى صفحات (pages) في الذاكرة الرئيسية، يدّلنا على أن المساحة الواقعية للبرنامج مقسمة إلى صفحات كما أن تخزين هذه الصفحات ليس متصًلا بل بحسب ما يتوفر لنا من أماكن شاغرة في الذاكرة الرئيسية
9

Slide 10:
10
تقسيم الذاكرة إلى صفحات
في هذه الطريقة يتم تقسيم الذاكرة الفيزيائية (RAM) إلى إطارات خالية (Page Frame) وهذه الإطارات
تكون جاهزة للاستقبال مايساوي  حجمها من أجزاء صفحات منطقية . تمثل أجزاء البرنامج المراد تشغيله
بذلك يوضع كل جزاء من البرنامج في إطار مناسب له على الذاكرة .
بحيث يكون حجم الإطار اكبر من أو يساوي حجم جزء البرنامج الموضوع علية.

Slide 11:
Paging Model of Logical and Physical Memory
12/24/2019
11

Slide 12:
Virtual Memory
الذاكرة التخيلية ليست عبارة عن استخدام مساحات في القرص الصلب لتوسعة مساحة الذاكرة الحقيقة فقط, ولكنها تهدف إلى مخادعة البرامج لتظن أنها تستخدم مساحات كبيرة ومتجاورة من الذاكرة استعانًة بالقرص الصلب، بالتالي فإن القرص الصلب يوصف بأنه في هذه الحالة يتظاهر بأنه جزء من الذاكرة العشوائية، ويوهم البرامج بأنه امتداد لها.
12
أسباب تقسيم الذاكرة الافتراضية:
حيث إن الذاكرة الافتراضية جزء من القرص الصلب فإذا كانت جزء واحد فقط بالتأكيد سيحدث تداخل متوقع بين البرامج اثنا التشغيل.
اثنا البرنامج يتوقع نمو البرنامج لذلك من الضروري تحديد حجم مناسب له يراعي خاصية النمو.

Slide 13:
Virtual Memory
يقوم نظام التشغيل بالبحث عن الأجزاء الغير مستعملة باستمرار من الذاكرة العشوائية ثم يقوم بنسخها في القرص الصلب وبذلك فانه يتيح مساحه أكبر في الذاكرة العشوائية حتى يتمكن نظام التشغيل من استخدام جزءًا أكبر من الذاكرة العشوائية في تشغيل تطبيقاته.
أهمية الذاكرة الافتراضية
الذاكرة الافتراضية هي جزء من القرص الصلب يقوم نظام التشغيل بتحويله للعمل وكأنة ذاكرة .
تعمل هذه الذاكرة الافتراضية مع الذاكرة الرئيسية كوحدة واحدة. وبذلك يتم توسيع وتكبير حجم الذاكرة  بشكل كبير
13

Slide 14:
14
تطوير العمل يتلاءم مع وجود الذاكرة الافتراضية
أصبح من الضروري تطوير أساليب تحميل البرامج على الذاكرة لاستيعاب مفهوم الذاكرة الافتراضية بحيث لا يحدث  مشاكل في الربط بين الجزء الافتراضي والجزء الرئيسي من الذاكرة وبذلك يتم إدارة الذاكرة كالتالي:-
1.     تقسيم البرامج إلى طبقات يتم تحميل الطبقات النشطة فقط على الذاكرة.
2.     وضع باقي الطبقات على الجزء الافتراضي لذاكرة.
3.     يتم التبادل بين الجزء الافتراضي والجزء الرئيسي من الذاكرة وذلك بتحميل الطبقات التي تنشط
وتنزيل الطبقات التي تم تنفيذها .
4.     الاستفادة من هذا التوسع في الذاكرة بتشغيل عدد كبير من البرامج في آن واحد.

Slide 15:
15
تقسيم الذاكرة إلى صفحات
أداة الاستعانة  بمفهوم الذاكرة الافتراضية وتطبيقها في تقنيات الكمبيوتر في ظهور ما يسمى بالصفحات (page ) :
وذلك لتلائم عملية التبادل بن أجزاء البرنامج الواحد في كل من الذاكرة الرئيسية والذاكرة الافتراضية (وسائط التخزين )
وبذلك أمكن توسعة الذاكرة وتقسيمها بطريقة تستوعب اكبر عدد ممكن  من البرامج وتشغيلها في آن واحد.
D  طريقة تقسيم الذاكرة إلى صفحات
تقوم هذه العملية على معاملين هما :
1.     سعة الذاكرة
2.     حجم البرنامج
وتتم كالأتي:
1.     تقسيم الذاكرة الرئيسية RAM) الفيزيائية ) إلى إطارات (Frames  ) .
2.   يتم تقسيم البرنامج إلى صفحات (Pages) بحيث يكون حجم كل صفحة اصغر من أو يساوي حجم  الإطار الموافق له على الذاكرة الفيزيائية وبالتالي يتم تحميل كل صفحه على إطار.
3.     يتم تبادل الصفحات بين الذاكرة والذاكرة الثانوية.

Slide 16:
Virtual Memory
عملية التبديل التي تتم بين الذاكرة العشوائية و القرص الصلب تتم في شفافية تامة (transparency) فمستخدم الجهاز يكاد أن لا يشعر بهذه العملية، وبذلك نكون قد حظينا بجزء أكبر من الذاكرة العشوائية وأيضا زيادة في عدد التطبيقات التي يعمل عليها المستخدم في الجهاز.
16

Slide 17:
17
القواعد المتبعة لتقسيم الذاكرة الافتراضية تقسيم الذاكرة الافتراضية يكون إلى قطاعات حيث إن الذاكرة الافتراضية جزء من القرص الصلب.
كل قطاع يكون مستقل عن باقي القطاعات ويعمل كجزء منفصل تماماً.
يعمل كل قطاع كسلسلة متصلة من خلايا الذاكرة .
تقسيم الذاكرة المنطقية (البرامج) تقسيم بسيط وفيه يتم تقسيم البرامج إلى طبقات ويتم تحميل كل طبقة على قطاع من قطاع الذاكرة.
التقسيم إلى صفحات ويكون على طريقتين:
التصفح البسيط:
وفيه يتم تقسيم البرامج إلى صفحات متساوية الحجم وذلك يؤدي إلى تقسيم الذاكرة الرئيسية إلى إطارات متساوية الحجم .
التصفح المرئي :
وفيه يتم تقسيم الصفحات إلى صفحات غير متساوية وتوضع كل صفحة على الإطار المناسب لها على الذاكرة الرئيسية التي تقسم إلى أطارت غير متساوية كذلك .
مميزات تقسيم الذاكرة المنطقيةزيادة كفاءة الذاكرة والانتفاع الأمثل بها مقارنة بالأساليب الأخرى .
تقليل التفتت الداخلي للذاكرة. (يقوم نظام تشغيل بحجز مسا حة اكبر للبرامج)
استخدام مفهوم الذاكرة الافتراضية مما يزيد كثيراً من حجم الذاكرة اثنا التشغيل.
تحقيق اكبر قدر ممكن من الحماية اثنا التشغيل .
تشغيل اكبر قدر ممكن من البرامج في آن واحد.

Slide 18:
Virtual Memory
عيوب هذه التقنية :-
المساحة الداعمة (backing store)
الوقت، تزيد عدد مرات مقاطعة البرامج
تعقيد أساليب إدارة الذاكرة التي تتعامل مع إدارة  الذاكرة
18

Slide 19:
19
Paging
Each process has its own page table
Each page table entry contains the frame number of the corresponding page in main memory
A bit is needed to indicate whether the page is in main memory or not

Slide 20:
طلب الصفحات   Demand Paging
20
عند القيام باستخدام برنامج ما فان هذا البرنامج يتم تقسيمه لصفحات Paging وهذه الصفحات Pages يتم تحميلها للذاكرة لكي يتم تنفيذ هذا البرنامج .
توجد الية تسمى Demand Paging in Virtual Memory لا تقوم بتحميل جميع صفحات البرنامج الى (RAM) .
إنما فقط الصفحات المطلوبة لتنفيذ العمليات التي يقوم بها المستخدم لهذا البرنامج

Slide 21:
21
طرق أدارت الذاكرة
أولا : برنامج واحد ذاكرة واحدة :
في هذه الطريقة يعتمد مدير الذاكرة على تقنية سهلة وبسيطة لكنها بدائية للغاية في إدارة الذاكرة حيث يتم تشغيل
برنامج واحد فقط مهما كان حجمه صغيراً على الذاكرة ومهما كان حجم الذاكرة كبيراً. ولا يتم تشغيل أي برنامج
آخر حتى ينتهي عمل الأول ويتم اخراجة واغلاقة من الذاكرة ويأتي الذي يليه.
مميزاته
1.     سهولة تحميل وتشغيل البرامج.
2.     سهولة نقل البرامج من وسائط التخزين إلى الذاكرة والعكس .
3.     سهولة وقت حفظ المخرجات من البرنامج .
4.     الحماية المطلقة للبيانات من التداخل والتضارب.
عيوبه
1.     عدم التوافق مع الحاسبات الكبيرة .
2.     إهدار الوقت والجهد.
3.     بطيء تنفيذ البرامج . حيث أنها تعتمد على توالي التنفيذ وليس التنفيذ في آن واحد
4.     هذه الطريقة مناسبة فقط للحاسبات أحادية المهمة (البدائية).

Slide 22:
22
ثانياَ :ذاكرة متعددة وبرامج متعددة:
في هذه الحالة تكون عملية إدارة الذاكرة معقدة وتحتاج إلى مدير ذاكرة أقصى مرونة ودينامكية
في الحالة السابقة وفي هذه الحالة تكون وظائف مدير الذاكرة كالآتي:
1.     إعداد قائمة انتظار للبرامج المراد تحميلها على الذاكرة.
2.     وضع طريقة للمفاضلة في ترتيب أولوية تحميل البرامج على الذاكرة.
3.     إعداد قائمة بأجراء وحجم الذاكرة المتاحة لتشغيل .
4.     تحديد طريقة يتم على أساسها تخصص الجزء المناسب من الذاكرة لبرنامج محدد.
5.     حماية البرامج إثناء التشغيل .

Slide 23:
Lazy Pager
وحين يريد المستخدم استخدام جزئية جديدة من البرنامج موجودة في صفحات لم يتم تحميلها إلى الذاكرة سيتم تحميل الصفحات المطلوبة عن طريق Lazy Pager
23

Slide 24:
What do we do when we run out of memory?
E.g., all memory partitions of operating system available for user processes are full
Options
System.exit
Something else
24

Slide 25:
A process can be swapped temporarily out of memory to a backing store, and then brought back into memory for continued execution
Backing store – fast disk large enough to accommodate copies of all memory images for all users; must provide direct access to these memory images
Roll out, roll in – swapping variant used for priority-based scheduling algorithms; lower-priority process is swapped out so higher-priority process can be loaded and executed
Major part of swap time is transfer time; total transfer time is directly proportional to the amount of memory swapped
Modified versions of swapping are found on many systems (i.e., UNIX, Linux, and Windows)
Swapping is one solution

Slide 26:
Schematic View of Swapping
12/24/2019
File Management
26

Slide 27:
Page Fault
– A page fault happens when a running program accesses a memory page that is mapped into the virtual address space, but not loaded in physical memory.
Since actual physical memory is much smaller than virtual memory, page faults happen. In case of page fault, Operating System might have to replace one of the existing pages with the newly needed page. Different page replacement algorithms suggest different ways to decide which page to replace. The target for all algorithms is to reduce the number of page faults.
12/24/2019
File Management
27

Slide 28:
Page-fault
28

